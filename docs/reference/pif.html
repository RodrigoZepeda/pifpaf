<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Estimates the potential impact fraction, pif, for
individual-level exposure data (and covariates), X, from a
cross-sectional survey. Exposure is assumed to be associated with
a relative risk function, rr, with parameter theta. A counterfactual
scenario as a function of the exposure cft is assumed.
The potential impact fraction is defined Chan et al. (2023)
:


\[
 \text{PIF} = \dfrac{\mathbb{E}\Big[RR(X;\theta)\Big] -
   \mathbb{E}\Big[RR\big(\text{cft}(X);\theta\big)\Big]}{\mathbb{E}\Big[RR(X;\theta)\Big]}
\]
where:
\(X\) denotes the individual-level matrix of exposure and covariates,
\(\theta\) represents additional parameters of the relative risk function,
\(RR(X,\theta)\) denotes the relative risk of exposure (and covariates) at level
\(X\) given parameters \(\theta\),
\(cft(X)\) denotes the counterfactual function applied to exposure and covariates,
\({\mathbb{E}\Big[RR(X;\theta)\Big]}\) and
\({\mathbb{E}\Big[RR(\text{cft}(X);\theta)\Big]}\) denote the population average relative
risk under current (observed) conditions and the relative risk under the counterfactual scenario.
\(\text{PIF}\) represents the potential impact fraction.

"><title>Potential Impact Fraction — pif • pifpaf</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Potential Impact Fraction — pif"><meta property="og:description" content="Estimates the potential impact fraction, pif, for
individual-level exposure data (and covariates), X, from a
cross-sectional survey. Exposure is assumed to be associated with
a relative risk function, rr, with parameter theta. A counterfactual
scenario as a function of the exposure cft is assumed.
The potential impact fraction is defined Chan et al. (2023)
:


\[
 \text{PIF} = \dfrac{\mathbb{E}\Big[RR(X;\theta)\Big] -
   \mathbb{E}\Big[RR\big(\text{cft}(X);\theta\big)\Big]}{\mathbb{E}\Big[RR(X;\theta)\Big]}
\]
where:
\(X\) denotes the individual-level matrix of exposure and covariates,
\(\theta\) represents additional parameters of the relative risk function,
\(RR(X,\theta)\) denotes the relative risk of exposure (and covariates) at level
\(X\) given parameters \(\theta\),
\(cft(X)\) denotes the counterfactual function applied to exposure and covariates,
\({\mathbb{E}\Big[RR(X;\theta)\Big]}\) and
\({\mathbb{E}\Big[RR(\text{cft}(X);\theta)\Big]}\) denote the population average relative
risk under current (observed) conditions and the relative risk under the counterfactual scenario.
\(\text{PIF}\) represents the potential impact fraction.

"><meta property="og:image" content="https://rodrigozepeda.github.io/pifpaf/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-secondary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">pifpaf</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.0.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/Biostatistics.html">How the methods work (biostatistics)</a>
    <a class="dropdown-item" href="../articles/Collection-of-examples.html">Collection of examples</a>
    <a class="dropdown-item" href="../articles/Epidemiology-101.html">Epidemiology 101: The attributable and impact fractions</a>
  </div>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="http://twitter.com/RodZepeda" aria-label="Twitter">
    <span class="fa fa-twitter"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Potential Impact Fraction</h1>
      
      <div class="d-none name"><code>pif.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Estimates the <strong>potential impact fraction</strong>, <code>pif</code>, for
<strong>individual-level exposure</strong> data (and covariates), <code>X</code>, from a
cross-sectional survey. Exposure is assumed to be associated with
a <strong>relative risk</strong> function, <code>rr</code>, with parameter <code>theta</code>. A <strong>counterfactual</strong>
scenario as a function of the exposure <code>cft</code> is assumed.</p>
<p>The <strong>potential impact fraction</strong> is defined Chan et al. (2023)
:
<script id="MathJax-script" async src="../../mathjaxr/doc/mathjax/es5/tex-chtml-full.js"></script>

\[
 \text{PIF} = \dfrac{\mathbb{E}\Big[RR(X;\theta)\Big] -
   \mathbb{E}\Big[RR\big(\text{cft}(X);\theta\big)\Big]}{\mathbb{E}\Big[RR(X;\theta)\Big]}
\]</p>
<p>where:</p><ul><li><p><em></em>\(X\) denotes the individual-level matrix of exposure and covariates,</p></li>
<li><p><em></em>\(\theta\) represents additional parameters of the relative risk function,</p></li>
<li><p><em></em>\(RR(X,\theta)\) denotes the relative risk of exposure (and covariates) at level
<em></em>\(X\) given parameters <em></em>\(\theta\),</p></li>
<li><p><em></em>\(cft(X)\) denotes the counterfactual function applied to exposure and covariates,</p></li>
<li><p><em></em>\({\mathbb{E}\Big[RR(X;\theta)\Big]}\) and
<em></em>\({\mathbb{E}\Big[RR(\text{cft}(X);\theta)\Big]}\) denote the population average relative
risk under current (observed) conditions and the relative risk under the counterfactual scenario.</p></li>
<li><p><em></em>\(\text{PIF}\) represents the potential impact fraction.</p></li>
</ul></div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">pif</span><span class="op">(</span></span>
<span>  <span class="va">design</span>,</span>
<span>  <span class="va">theta</span>,</span>
<span>  <span class="va">rr</span>,</span>
<span>  cft <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">additional_theta_arguments</span>,</span>
<span>  n_bootstrap_samples <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  theta_distribution <span class="op">=</span> <span class="st">"default"</span>,</span>
<span>  is_paf <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  weights <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  .options.future <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>seed <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>design</dt>
<dd><p>(<code>survey.design</code>, <code>data.frame</code>,<code>tibble</code>, or <code>svyrep.design</code>) survey data
structure. If data comes from a survey set the <code>design</code> with <code><a href="https://rdrr.io/pkg/survey/man/svydesign.html" class="external-link">survey::svydesign()</a></code>. It can
also support a <code><a href="https://rdrr.io/pkg/survey/man/svrepdesign.html" class="external-link">survey::svrepdesign()</a></code> design if your survey comes with replicates.
Finally, the model can also accommodate a <code>data.frame</code> or <code>tibble</code> with weights assuming
simple random sampling without replacement.</p></dd>


<dt>theta</dt>
<dd><p>(<code>vector</code>/<code>double</code>) parameters of the relative risk function <code>rr</code>.</p></dd>


<dt>rr</dt>
<dd><p>(<code>function</code>/<code>list</code>) a relative risk function with two parameters: a <code>data.frame</code> called
<code>X</code> containing the individual-level exposure and covariates, and <code>theta</code> (in that order). It can
also be a list of several relative risk functions to apply with each function being a
different modelling scenario.</p></dd>


<dt>cft</dt>
<dd><p>(<code>function</code>/<code>list</code>) a counterfactual function that takes a <code>data.frame</code>, <code>X</code>, of
individual-level exposure and covariates and returns a new <code>data.frame</code> of individual-level
counterfactual exposure and covariates. It can also be a list of several counterfactual
functions to apply with each function being a different modelling scenario.</p></dd>


<dt>additional_theta_arguments</dt>
<dd><p>any additional information on <code>theta</code> utilized
for obtaining bootstrap samples from the paramter. Options are:</p><ul><li><p>(<code>double</code>) the <strong>variance</strong> of <code>theta</code> if <code>theta</code> is
one dimensional and asymptotical normality is assumed (default).</p></li>
<li><p>(<code>vector</code>) the <strong>variances</strong> of each entry of <code>theta</code> if <code>theta</code> is
n-dimensional and its entries are uncorrelated and asymptotical normality is assumed (default).</p></li>
<li><p>(<code>matrix</code>) the <strong>variance-covariance</strong> matrix of <code>theta</code> if <code>theta</code> is
n-dimensional and its entries are correlated and asymptotical normality is assumed (default).</p></li>
<li><p>any list of arguments to pass via <code><a href="https://rdrr.io/r/base/do.call.html" class="external-link">base::do.call()</a></code> to <code>theta_distribution</code> to
simulate samples from <code>theta</code> if <code>theta</code> is not assumed to be asymptotically normally
distributed.</p></li>
</ul><p><strong>Optional</strong></p></dd>


<dt>n_bootstrap_samples</dt>
<dd><p>(<code>double</code>) number of bootstrap samples. If a <code>svyrep.design</code> is passed
as an argument, then <code>n_bootstrap_samples</code> represents the number of number of replicates in
the design.</p></dd>


<dt>theta_distribution</dt>
<dd><p>(<code>function</code>) random number generator that follows
the distribution of the estimator <code>theta</code>. By default, <code>theta</code> is assumed to be asymptotically
normal and thus <code>theta_distribution</code> is set to <code><a href="https://rdrr.io/pkg/mvtnorm/man/Mvnorm.html" class="external-link">mvtnorm::rmvnorm()</a></code> with
variance given by <code>additional_theta_arguments</code>. The number of simulations for the
<code>theta_distribution</code> function must be parametrized by a parameter of name <code>n</code>.</p></dd>


<dt>is_paf</dt>
<dd><p>(<code>boolean</code>) Whether the function being estimated is the Population
Attributable Fraction (<code>is_paf = TRUE</code>) or the Potential Impact Fraction
(<code>is_paf = FALSE</code>)</p></dd>


<dt>weights</dt>
<dd><p>(<code>vector</code>) If you are not following the recommended version and use a
<code>svydesign</code> object for the design you can still use <code>weights</code> to associate
weights to your estimation. Beware that it might not give accurate estimations of the variance
nor the uncertainty intervals.</p></dd>


<dt>.options.future</dt>
<dd><p>List of additional options for <code>doFuture::%dofuture%()</code>.</p></dd>


<dt>...</dt>
<dd><p>Additional parameters for <code><a href="https://bschneidr.github.io/svrep/reference/as_bootstrap_design.html" class="external-link">svrep::as_bootstrap_design()</a></code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>A <code><a href="pif_class.html">pif_class()</a></code> object containing the bootstrap simulations for the
potential impact fraction, the average relative risk, and the average
counterfactual if applicable.</p>
    </div>
    <div class="section level2">
    <h2 id="additional-parallelization-options">Additional parallelization options<a class="anchor" aria-label="anchor" href="#additional-parallelization-options"></a></h2>
    

<p>Faster computation occurs when doing parallelization which allows to use more cores in your
machine. Parallelization utilizes  the <code><a href="https://future.futureverse.org/reference/future.html" class="external-link">future::future()</a></code> package. For paralelization to work you
need to establish a plan (see <code><a href="https://future.futureverse.org/reference/plan.html" class="external-link">future::plan()</a></code> for more information). The most common
way to create parallelization in your local machine is to do:</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">plan</span>(multisession) <span class="co">#Start parallelization</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="fu">pif</span>(...)</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="fu">plan</span>(sequential) <span class="co">#Return to 'normal'</span></span></code></pre><p></p></div>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Chan CE, Zepeda-Tello R, Camacho-García-Formentí D, Cudhea F, Meza R, Rodrigues E, Spiegelman D, Barrientos-Gutierrez T, Zhou X (2023).
“Nonparametric Estimation of the Potential Impact Fraction and Population Attributable Fraction with Individual-Level and Aggregated Data.”
2207.03597.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="paf.html">paf()</a></code> <code><a href="plot.pif_class.html">plot.pif_class()</a></code> <code><a href="summary.pif_class.html">summary.pif_class()</a></code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Use the ensanut dataset</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">ensanut</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># EXAMPLE 1</span></span></span>
<span class="r-in"><span><span class="co"># Setup the survey design</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>survey.lonely.psu <span class="op">=</span> <span class="st">"adjust"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">design</span> <span class="op">&lt;-</span> <span class="fu">survey</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/survey/man/svydesign.html" class="external-link">svydesign</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">ensanut</span>, ids <span class="op">=</span> <span class="op">~</span><span class="fl">1</span>, weights <span class="op">=</span> <span class="op">~</span><span class="va">weight</span>, strata <span class="op">=</span> <span class="op">~</span><span class="va">strata</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">rr</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">X</span>, <span class="va">theta</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2</span> <span class="op">+</span></span></span>
<span class="r-in"><span>    <span class="va">theta</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">*</span> <span class="va">X</span><span class="op">[</span>, <span class="st">"age"</span><span class="op">]</span> <span class="op">+</span> <span class="va">theta</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">*</span> <span class="va">X</span><span class="op">[</span>, <span class="st">"systolic_blood_pressure"</span><span class="op">]</span> <span class="op">/</span> <span class="fl">100</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span><span class="va">cft</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">X</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">X</span><span class="op">[</span>, <span class="st">"systolic_blood_pressure"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">X</span><span class="op">[</span>, <span class="st">"systolic_blood_pressure"</span><span class="op">]</span> <span class="op">-</span> <span class="fl">5</span></span></span>
<span class="r-in"><span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span><span class="fu">pif</span><span class="op">(</span><span class="va">design</span>,</span></span>
<span class="r-in"><span>  theta <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.05</span>, <span class="fl">1.38</span><span class="op">)</span><span class="op">)</span>, <span class="va">rr</span>, <span class="va">cft</span>,</span></span>
<span class="r-in"><span>  additional_theta_arguments <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.01</span>, <span class="fl">0.03</span><span class="op">)</span>, n_bootstrap_samples <span class="op">=</span> <span class="fl">10</span>,</span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> ── Potential Impact Fraction (PIF) ─────────────────────────────────────────────</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     counterfactual   relative_risk potential_impact_fraction</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 Counterfactual_1 Relative_Risk_1               0.014760072</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 Counterfactual_1 Relative_Risk_1              -0.001760528</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 Counterfactual_1 Relative_Risk_1               0.031280671</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   average_relative_risk average_counterfactual           type</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1              5607.727               5509.783 point_estimate</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2            -15080.958             -14810.798     Lower 2.5%</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3             26296.412              25830.363    Upper 97.5%</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> ────────────────────────────────────────────────────────────────────────────────</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • Number of bootstrap simulations: 10</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #BB0000;">✖</span> A low number of bootstrap simulations will result in an unstable estimate.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • Use `as.data.frame` to access values.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • Use `summary` to save list of main results.</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># EXAMPLE 2</span></span></span>
<span class="r-in"><span><span class="co"># Now do the same but using a replicate design</span></span></span>
<span class="r-in"><span><span class="va">rep_design</span> <span class="op">&lt;-</span> <span class="fu">svrep</span><span class="fu">::</span><span class="fu"><a href="https://bschneidr.github.io/svrep/reference/as_bootstrap_design.html" class="external-link">as_bootstrap_design</a></span><span class="op">(</span><span class="va">design</span>, replicates <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">pif</span><span class="op">(</span><span class="va">rep_design</span>,</span></span>
<span class="r-in"><span>  theta <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.05</span>, <span class="fl">1.38</span><span class="op">)</span><span class="op">)</span>, <span class="va">rr</span>, <span class="va">cft</span>,</span></span>
<span class="r-in"><span>  additional_theta_arguments <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.01</span>, <span class="fl">0.03</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> ── Potential Impact Fraction (PIF) ─────────────────────────────────────────────</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     counterfactual   relative_risk potential_impact_fraction</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1 Counterfactual_1 Relative_Risk_1               0.016760903</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2 Counterfactual_1 Relative_Risk_1              -0.001709183</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 Counterfactual_1 Relative_Risk_1               0.035230988</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   average_relative_risk average_counterfactual           type</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1               47078.8               46254.13 point_estimate</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2             -171436.2             -168512.93     Lower 2.5%</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3              265593.8              261021.20    Upper 97.5%</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> ────────────────────────────────────────────────────────────────────────────────</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • Number of bootstrap simulations: 10</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #BB0000;">✖</span> A low number of bootstrap simulations will result in an unstable estimate.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • Use `as.data.frame` to access values.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • Use `summary` to save list of main results.</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># EXAMPLE 3</span></span></span>
<span class="r-in"><span><span class="co"># Calculate two different relative risks</span></span></span>
<span class="r-in"><span><span class="va">rr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span> <span class="kw">function</span><span class="op">(</span><span class="va">X</span>, <span class="va">theta</span><span class="op">)</span> <span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">theta</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">*</span> <span class="va">X</span><span class="op">[</span>, <span class="st">"systolic_blood_pressure"</span><span class="op">]</span> <span class="op">/</span> <span class="fl">100</span><span class="op">)</span><span class="op">}</span>,</span></span>
<span class="r-in"><span> <span class="kw">function</span><span class="op">(</span><span class="va">X</span>, <span class="va">theta</span><span class="op">)</span> <span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">theta</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">*</span> <span class="va">X</span><span class="op">[</span>, <span class="st">"systolic_blood_pressure"</span><span class="op">]</span> <span class="op">/</span> <span class="fl">100</span> <span class="op">+</span> <span class="va">theta</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span><span class="op">*</span> <span class="va">X</span><span class="op">[</span>,<span class="st">"age"</span><span class="op">]</span><span class="op">)</span><span class="op">}</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Calculate three counterfactual scenarios of SBP reduction from 1 to 3 mmhg</span></span></span>
<span class="r-in"><span><span class="va">cft</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span><span class="kw">function</span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">{</span><span class="va">X</span><span class="op">[</span>, <span class="st">"systolic_blood_pressure"</span><span class="op">]</span>  <span class="op">&lt;-</span> <span class="va">X</span><span class="op">[</span>, <span class="st">"systolic_blood_pressure"</span><span class="op">]</span>  <span class="op">-</span> <span class="fl">1</span>; <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">}</span>,</span></span>
<span class="r-in"><span><span class="kw">function</span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">{</span><span class="va">X</span><span class="op">[</span>, <span class="st">"systolic_blood_pressure"</span><span class="op">]</span>  <span class="op">&lt;-</span> <span class="va">X</span><span class="op">[</span>, <span class="st">"systolic_blood_pressure"</span><span class="op">]</span>  <span class="op">-</span> <span class="fl">2</span>; <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">}</span>,</span></span>
<span class="r-in"><span><span class="kw">function</span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">{</span><span class="va">X</span><span class="op">[</span>, <span class="st">"systolic_blood_pressure"</span><span class="op">]</span>  <span class="op">&lt;-</span> <span class="va">X</span><span class="op">[</span>, <span class="st">"systolic_blood_pressure"</span><span class="op">]</span>  <span class="op">-</span> <span class="fl">3</span>; <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">}</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">pif</span><span class="op">(</span><span class="va">design</span>,</span></span>
<span class="r-in"><span>  theta <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1.05</span>, <span class="fl">1.38</span>, <span class="fl">1.21</span><span class="op">)</span><span class="op">)</span>, <span class="va">rr</span>, <span class="va">cft</span>,</span></span>
<span class="r-in"><span>  additional_theta_arguments <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.01</span>, <span class="fl">0.03</span>, <span class="fl">0.025</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  n_bootstrap_samples <span class="op">=</span> <span class="fl">10</span>,</span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> ── Potential Impact Fraction (PIF) ─────────────────────────────────────────────</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      counterfactual   relative_risk potential_impact_fraction</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1  Counterfactual_1 Relative_Risk_1              0.0003597566</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2  Counterfactual_2 Relative_Risk_1              0.0007182515</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3  Counterfactual_3 Relative_Risk_1              0.0010754862</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4  Counterfactual_1 Relative_Risk_2              0.0031302785</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5  Counterfactual_2 Relative_Risk_2              0.0062467875</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6  Counterfactual_3 Relative_Risk_2              0.0093495944</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7  Counterfactual_1 Relative_Risk_1             -0.0021394858</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8  Counterfactual_1 Relative_Risk_1              0.0028589991</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9  Counterfactual_2 Relative_Risk_1             -0.0042777203</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10 Counterfactual_2 Relative_Risk_1              0.0057142233</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11 Counterfactual_3 Relative_Risk_1             -0.0064147075</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 12 Counterfactual_3 Relative_Risk_1              0.0085656799</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 13 Counterfactual_1 Relative_Risk_2             -0.0015499519</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 14 Counterfactual_1 Relative_Risk_2              0.0078105089</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 15 Counterfactual_2 Relative_Risk_2             -0.0030848133</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 16 Counterfactual_2 Relative_Risk_2              0.0155783882</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 17 Counterfactual_3 Relative_Risk_2             -0.0046046899</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 18 Counterfactual_3 Relative_Risk_2              0.0233038787</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    average_relative_risk average_counterfactual           type</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1           1.052909e+00           1.052386e+00 point_estimate</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2           1.052909e+00           1.051865e+00 point_estimate</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3           1.052909e+00           1.051345e+00 point_estimate</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4           5.892535e+18           5.885971e+18 point_estimate</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5           5.892535e+18           5.879414e+18 point_estimate</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6           5.892535e+18           5.872865e+18 point_estimate</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7           7.350943e-01           7.374154e-01     Lower 2.5%</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8           1.370724e+00           1.367358e+00    Upper 97.5%</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9           7.350943e-01           7.397347e-01     Lower 2.5%</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10          1.370724e+00           1.363996e+00    Upper 97.5%</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11          7.350943e-01           7.420521e-01     Lower 2.5%</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 12          1.370724e+00           1.360639e+00    Upper 97.5%</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 13         -3.556765e+19          -3.552826e+19     Lower 2.5%</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 14          4.735272e+19           4.730020e+19    Upper 97.5%</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 15         -3.556765e+19          -3.548891e+19     Lower 2.5%</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 16          4.735272e+19           4.724774e+19    Upper 97.5%</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 17         -3.556765e+19          -3.544961e+19     Lower 2.5%</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 18          4.735272e+19           4.719534e+19    Upper 97.5%</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> ────────────────────────────────────────────────────────────────────────────────</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • Number of bootstrap simulations: 10</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #BB0000;">✖</span> A low number of bootstrap simulations will result in an unstable estimate.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • Use `as.data.frame` to access values.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • Use `summary` to save list of main results.</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Rodrigo Zepeda-Tello, Dalia Camacho-García-Formentí.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

